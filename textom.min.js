!function(b,a){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define([],b):('undefined'!=typeof window?a=window:'undefined'!=typeof global?a=global:'undefined'!=typeof self&&(a=self),a.TextOMConstructor=b())}(function(){return function a(b,c,e){function f(d,k){if(!c[d]){if(!b[d]){var i=typeof require=='function'&&require;if(!k&&i)return i(d,!0);if(g)return g(d,!0);var j=new Error("Cannot find module '"+d+"'");throw j.code='MODULE_NOT_FOUND',j}var h=c[d]={exports:{}};b[d][0].call(h.exports,function(c){var a=b[d][1][c];return f(a?a:c)},h,h.exports,a,b,c,e)}return c[d].exports}var g=typeof require=='function'&&require;for(var d=0;d<e.length;d++)f(e[d]);return f}({1:[function(G,F,H){'use strict';function E(b,c,a){var d;if(!b[a])b[a]=c,a++;else while(c)d=b[a],b[a]=c,a++,c=d;b.length=a}function D(a,b){while(a[b])a[b]=a[++b];a.length--}function n(b,c){var a;a=-1;while(b[++a])if(b[a]===c)return a;return-1}function a(a){return function(b,h,e,f){var c,g,d;if(!b)return!0;if(b=b[h],!(b&&b.length))return!0;d=a.apply(f,e),c=-1,g=b.length,b=b.concat();while(++c<g){if(!d())return!1;b[c].apply(f,e)}return d()}}function C(c,b){var a;return a=c.allowedChildTypes,a&&a.length&&b.type?n(a,b.type)!==-1:!0}function l(a,e,c){var d,h,f,g,b,i;if(!a)throw new Error('TypeError: `'+a+'` is not a '+'valid `parent` for `insertAll`');if(!c)throw new Error('TypeError: `'+c+'` is not a '+'valid `children` for `insertAll`');if(h=c.length,!h)return c;if(e){if(e.parent!==a)throw new Error('HierarchyError: The operated on node is detached from `parent`');if(i=n(a,e),i===-1)throw new Error('HierarchyError: The operated on node is attached to `parent`, but `parent` has no index corresponding to the node')}d=-1;while(++d<h){if(b=c[d],typeof b.remove!=='function')throw new Error('TypeError: `'+b+'` does not '+'have a `remove` method');if(a===b)throw new Error('HierarchyError: Cannot insert `node` into self');b.remove()}e&&e.parent===a?g=e.next:(e=null,g=a.head,i=-1),d=-1,f=e;while(c[++d])b=c[d],b.parent=a,f&&(b.prev=f,f.next=b),f=b;g&&(f.next=g,g.prev=f),e?g||(a.tail=f):(a.head=c[0],!a.tail&&(g||h!==1)&&(a.tail=g||f)),d=i,b=c[0];while(b)a[++d]=b,b=b.next;a.length+=c.length,d=-1;while(c[++d])c[d].trigger('insert',a);return a.trigger('change',a),c}function b(a,c,b){var d,e;if(!a)throw new Error('TypeError: `'+a+'` is not a '+'valid `parent` for `insert`');if(!b)throw new Error('TypeError: `'+b+'` is not a '+'valid `child` for `insert`');if(a===b||a===c)throw new Error('HierarchyError: Cannot insert `node` into self');if(!C(a,b))throw new Error('HierarchyError: The operation would yield an incorrect node tree');if(typeof b.remove!=='function')throw new Error('TypeError: The operated on node does not have a `remove` method');if(c&&c===b)return b;if(b.remove(),b.parent=a,c){if(d=c.next,c.parent!==a)throw new Error('HierarchyError: The operated on node is detached from `parent`');if(e=n(a,c),e===-1)throw new Error('HierarchyError: The operated on node is attached to `parent`, but `parent` has no index corresponding to the node')}else c=null,d=a.head,e=-1;return c||d?(d&&(b.next=d,d.prev=b),c?(b.prev=c,c.next=b,(c===a.tail||!a.tail)&&(a.tail=b)):(a.head=b,a.tail||(a.tail=d)),E(a,b,e+1)):(a.head=b,a[0]=b,a.length=1),b.trigger('insert',a),a.trigger('change',a),b}function w(b){var a,c,d,e;if(!b)throw new Error('TypeError: `'+b+'` is not a '+'valid `node` for `remove`');if(a=b.parent,!a)return b;if(c=b.prev,d=b.next,a.tail===b&&(a.tail=c),a.head===b&&(a.head=d),a.tail===a.head&&(a.tail=null),c&&(c.next=d),d&&(d.prev=c),e=n(a,b),e===-1)throw new Error('HierarchyError: The operated on node is attached to `parent`, but `parent` has no index corresponding to the node');return D(a,e),b.prev=null,b.next=null,b.parent=null,b.trigger('remove',a,a),a.trigger('change',a),b}function y(a,b){if(a===null||a===undefined||a!==a||a===-Infinity)a=0;else if(a===Infinity)a=b;else if(typeof a!=='number')throw new TypeError('TypeError: `'+a+'` is not a '+'valid `position` for `#split()`');else a<0&&(a=Math.abs((b+a)%b));return a}function z(d,c){var a,b;a=d.data;for(b in a)t.call(a,b)&&(c.data||(c.data={}),c.data[b]=a[b])}function A(d){function f(){}var a,g,b,c,e;a=this,g=[d].concat(a.constructors||[a]),b=d.prototype,f.prototype=a.prototype,e=new f;for(c in b)e[c]=b[c];b.toString!=={}.toString&&(e.toString=b.toString),b.valueOf!=={}.valueOf&&(e.valueOf=b.valueOf);for(c in a)t.call(a,c)&&(d[c]=a[c]);e.constructor=d,d.constructors=g,d.prototype=e}function B(){function E(){this.data||(this.data={})}function F(){E.apply(this,arguments)}function G(){E.apply(this,arguments)}function t(){F.apply(this,arguments),G.apply(this,arguments)}function D(a){G.apply(this,arguments),this.fromString(a)}function M(){F.apply(this,arguments)}function L(){t.apply(this,arguments)}function K(){t.apply(this,arguments)}function J(){t.apply(this,arguments)}function I(){D.apply(this,arguments)}function N(){I.apply(this,arguments)}function O(){I.apply(this,arguments)}function P(){D.apply(this,arguments)}function Q(){D.apply(this,arguments)}var s,B,C,H,n;return s=E.prototype,s.nodeName=m,s.on=E.on=function(a,c){var b,d;if(b=this,typeof a!=='string'){if(a===null||a===undefined)return b;throw new Error('Illegal invocation: `'+a+'` '+'is not a valid `name` for '+'`on(name, handler)`')}if(typeof c!=='function'){if(c===null||c===undefined)return b;throw new TypeError('Illegal invocation: `'+c+'` '+'is not a valid `handler` for '+'`on(name, handler)`')}return d=b.callbacks||(b.callbacks={}),d=d[a]||(d[a]=[]),d.unshift(c),b},s.off=E.off=function(b,c){var a,d,e;if(a=this,(b===null||b===undefined)&&(c===null||c===undefined))return a.callbacks={},a;if(typeof b!=='string'){if(b===null||b===undefined)return a;throw new Error('Illegal invocation: `'+b+'` '+'is not a valid `name` for '+'`off(name, handler)`')}if(d=a.callbacks,!d)return a;if(d=d[b],!d)return a;if(typeof c!=='function'){if(c===null||c===undefined)return a.callbacks[b]=[],a;throw new Error('Illegal invocation: `'+c+'` '+'is not a valid `handler` for '+'`off(name, handler)`')}return e=d.indexOf(c),e!==-1&&d.splice(e,1),a},s.emit=function(d){var b,e,c,h,f,i,g,j;if(b=this,j=b.callbacks,g=a[d]||u,e=v.call(arguments,1),!g(j,d,e,b))return!1;if(c=b.constructor.constructors,!c)throw new Error('HierarchyError: The operated on node is not a node');i=c.length,f=-1;while(++f<i)if(h=c[f],!g(h.callbacks,d,e,b))return!1;return!0},s.trigger=function(d,g){var e,b,c,f;if(e=this,c=v.call(arguments,2),!e.emit.apply(e,[d].concat(c)))return!1;if(!g)return!0;d+='inside',f=a[d]||u,c=[e].concat(c),b=g;while(b){if(!f(b.callbacks,d,c,b))return!1;if(!f(b.constructor.callbacks,d,c,b))return!1;b=b.parent}return!0},E.isImplementedBy=A,B=F.prototype,B.nodeName=o,B.head=null,B.tail=null,B.length=0,B.prepend=function(a){return b(this,null,a)},B.prependAll=function(a){return l(this,null,a)},B.append=function(a){return b(this,this.tail||this.head,a)},B.appendAll=function(a){return l(this,this.tail||this.head,a)},B.item=function(a){if(a===null||a===undefined)a=0;else if(typeof a!=='number'||a!==a)throw new Error('TypeError: `'+a+'` '+'is not a valid `index` for '+'`item(index)`');return this[a]||null},B.toString=function(){return x.call(this,'')},B.valueOf=function(){var a,b,c,d;a=this,c=[],d={type:a.type||'',children:c},b=-1;while(a[++b])c[b]=a[b].valueOf();return z(a,d),d},E.isImplementedBy(F),C=G.prototype,C.nodeName=p,C.parent=null,C.next=null,C.prev=null,C.before=function(a){return b(this.parent,this.prev,a)},C.beforeAll=function(a){return l(this.parent,this.prev,a)},C.after=function(a){return b(this.parent,this,a)},C.afterAll=function(a){return l(this.parent,this,a)},C.replace=function(c){var a;return a=b(this.parent,this,c),w(this),a},C.remove=function(){return w(this)},E.isImplementedBy(G),F.isImplementedBy(t),G.isImplementedBy(t),t.prototype.split=function(c){var a,d,e;a=this,c=y(c,a.length),d=b(a.parent,a.prev,new a.constructor),e=-1;while(++e<c&&a[0])d.append(a[0]);return d},t.constructors.splice(2,0,F),t.prototype.nodeName=q,H=D.prototype,H.nodeName=k,H.internalValue='',H.toString=function(){return this.internalValue},H.valueOf=function(){var a,b;return a=this,b={type:a.type||'',value:a.internalValue},z(a,b),b},H.fromString=function(a){var b,d,c;return b=this,a===null||a===undefined?a='':a=String(a),d=b.toString(),a!==d&&(c=b.parent,b.internalValue=a,b.trigger('changetext',c,a,d),c&&c.trigger('change',c)),a},H.split=function(c){var a,d,e;return a=this,d=a.internalValue,c=y(c,d.length),e=b(a.parent,a.prev,new a.constructor),a.fromString(d.slice(c)),e.fromString(d.slice(0,c)),e},G.isImplementedBy(D),M.prototype.type=r,M.prototype.allowedChildTypes=[h,c,d],F.isImplementedBy(M),L.prototype.type=h,L.prototype.allowedChildTypes=[i,c,d],t.isImplementedBy(L),K.prototype.type=i,K.prototype.allowedChildTypes=[g,e,f,c,d],t.isImplementedBy(K),J.prototype.type=g,J.prototype.allowedChildTypes=[j,e,f],t.isImplementedBy(J),I.prototype.type=e,D.isImplementedBy(I),N.prototype.type=f,I.isImplementedBy(N),O.prototype.type=c,I.isImplementedBy(O),P.prototype.type=d,D.isImplementedBy(P),Q.prototype.type=j,D.isImplementedBy(Q),n={},n.NODE=m,n.PARENT=o,n.CHILD=p,n.ELEMENT=q,n.TEXT=k,n.Node=E,n.Parent=F,n.Child=G,n.Element=t,n.Text=D,n.RootNode=M,n.ParagraphNode=L,n.SentenceNode=K,n.WordNode=J,n.SymbolNode=I,n.PunctuationNode=N,n.WhiteSpaceNode=O,n.SourceNode=P,n.TextNode=Q,n.ROOT_NODE=r,n.PARAGRAPH_NODE=h,n.SENTENCE_NODE=i,n.WORD_NODE=g,n.SYMBOL_NODE=e,n.PUNCTUATION_NODE=f,n.WHITE_SPACE_NODE=c,n.SOURCE_NODE=d,n.TEXT_NODE=j,s.TextOM=n,s.NODE=m,s.PARENT=o,s.CHILD=p,s.ELEMENT=q,s.TEXT=k,s.ROOT_NODE=r,s.PARAGRAPH_NODE=h,s.SENTENCE_NODE=i,s.WORD_NODE=g,s.SYMBOL_NODE=e,s.PUNCTUATION_NODE=f,s.WHITE_SPACE_NODE=c,s.SOURCE_NODE=d,s.TEXT_NODE=j,n}var t,s,v,x;t=Object.prototype.hasOwnProperty,s=Array.prototype,v=s.slice,x=s.join;var r,h,i,g,e,f,c,d,j;r='RootNode',h='ParagraphNode',i='SentenceNode',g='WordNode',e='SymbolNode',f='PunctuationNode',c='WhiteSpaceNode',d='SourceNode',j='TextNode';var m,o,p,q,k;m='Node',o='Parent',p='Child',q='Element',k='Text',a.remove=a(function(b){var a;return a=this,function(){return b!==a.parent}}),a.insert=a(function(){var a,b;return a=this,b=a.parent,function(){return b===a.parent}}),a.insertinside=a(function(a){var b;return b=a.parent,function(){return a.parent===b}}),a.removeinside=a(function(a,b){return function(){return a.parent!==b}});var u;u=a(function(){return function(){return!0}}),F.exports=B},{}]},{},[1])(1)})
